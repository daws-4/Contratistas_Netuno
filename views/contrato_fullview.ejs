<%- include("partials/_head") %>
    <% if (login && (contratos[0]!= undefined)) {%>

<!--Menu superior ADMINISTRADORES--> <% if (rol == 2) {%>
</head>
<body>
    
    <section class="bienvenidos">
        <%- include("partials/_header_logged_admin") %>

        <div class="welcomers text-center">
            <% if (sexo) { %>
           
                <h5 id="welcomers" class=" wow bounceIn">Bienvenida </h5> <h5 class="nombre_contrat wow bounceIn"> <%=name %> </h5>

            <% }else{ %>

                <h5 id="welcomers" class=" wow bounceIn">Bienvenido </h5> <h5 class="nombre_contrat wow bounceIn"> <%=name %> </h5>

           <% } %>
        </div>
        <div class="contratos_firstview">
            <h6 id="welcomers"> CONTRATO  <%=contratos[0][0].id %></h6>
            <table id="lista-contratos" class="secondary-table table-striped">
                <thead> 
                    <tr>
                        <th>Fecha contrato</th>
                        <th>ID de la ONT</th>
                        <th>Status</th>
                        <th>Cédula del Cliente</th>
                        <th>ID Cuenta del Cliente</th>
                        <th>Plan Contratado</th>
                        <th>Dirección de Contrato</th>
                        <th>Motivo de Pausa</th>
                        <th>Fecha de Instalación</th>
                        <th>Recursos Usados</th>
                        <th>Observaciones</th>
                        <th>Contratista Asignado</th>
                        <th>Empresa Contratista</th>
                        <th>Teléfono del Cliente</th>
                        <th>Nodo</th>
                    </tr>
                </thead>
                <% if (contratos[0] != undefined) {%>
                <tbody>
                <% for (let index = 0; index < contratos[0].length; index++) { %>
                    <tr >
                        <td><%=contratos[0][index].fecha_contrato %></td>
                        <td><%=contratos[0][index].id %></td>
                        <% if (contratos[0][index].estatus_ == 0){%>
                            <td>Agendado</td>
                            <% }else if (contratos[0][index].estatus_ == 1){ %>
                                <td>Instalado</td>
                            <% }else if(contratos[0][index].estatus_ == 2){ %>
                                <td>Finalizado</td>
                            <% } %>

                        <td><%=contratos[0][index].ci_cliente %></td>
                        <td><%=contratos[0][index].id_cuenta %></td>
                        <td><%=contratos[0][index].plan_contratado %></td>
                        <td><%=contratos[0][index].direccion_contrato %></td>
                        <td><%=contratos[0][index].motivo_standby %></td>
                        <td><%=contratos[0][index].fecha_instalacion %></td>
                        <td><%=contratos[0][index].recursos_inventario_instalacion %></td>
                        <td><%=contratos[0][index].observaciones_instalacion %></td>
                        <td><%=contratos[0][index].contratista_asignado %></td>
                        <td>
                            <%if(contratos[0][index].empresa_contratista){%>
                            Servitel
                            <% }else{ %>
                            Hetelca
                            <% } %>
                            </td>
                        <td><%=contratos[0][index].telefono_cliente %></td>
                        <td><%=contratos[0][index].nodo %></td>
                    </tr> 
                </tbody>
            </table>
          </div>
          <div class="contrat-status text center">
            <form class="boton-update" action="/update-contrato/<%=contratos[0][0].id%>" method="GET">
                <a class="botons-green" href="/update-contrato/<%=contratos[0][0].id%>"> EDITAR</a>
                <a class="botons-red" href="/delete-contrato/<%=contratos[0][0].id%>" onclick="miAlerta()"> ELIMINAR</a>
                <% if (contratos[0][index].estatus_ != 2) {%>
                <a class="botons-red" href="/finish-contrato/<%=contratos[0][0].id%>" onclick="miAlerta_Finalizar()"> FINALIZAR</a>
                <% } %>
                <script>
                    function miAlerta(evento) {
                        const confirmDelete = window.confirm("¿Estás seguro que deseas ELIMINAR este contrato?")
                        if (!(confirmDelete)){
                            event.preventDefault();
                        }}
                        function miAlerta_Finalizar(evento) {
                        const confirmDelete = window.confirm("¿Estás seguro que deseas FINALIZAR este contrato?")
                        if (!(confirmDelete)){
                            event.preventDefault();
                        }}
                </script>
            </form>
        </div>
                <% } %>
                
        <% }else{ %>
        <tbody>
            <tr>
                <td></td>
                <td></td>
                <td></td>
            </tr> 
        </tbody>
    </table>
  </div>

        <% } %>
       

    </section>

    <% }else if (rol == 1){ %>
        <% if (empresa_contratista == contratos[0][0].empresa_contratista){ %>
        </head>
        <body>
            
            <section class="bienvenidos">
                <%- include("partials/_header_logged_admin") %>
        
                <div class="welcomers text-center">
                    <% if (sexo) { %>
                   
                        <h5 id="welcomers" class=" wow bounceIn">Bienvenida </h5> <h5 class="nombre_contrat wow bounceIn"> <%=name %> </h5>
        
                    <% }else{ %>
        
                        <h5 id="welcomers" class=" wow bounceIn">Bienvenido </h5> <h5 class="nombre_contrat wow bounceIn"> <%=name %> </h5>
        
                   <% } %>
                </div>
                <div class="contratos_firstview">
                    <h6 id="welcomers"> CONTRATO  <%=contratos[0][0].id %></h6>
                    <table id="lista-contratos" class="secondary-table table-striped">
                        <thead> 
                            <tr>
                                <th>Fecha contrato</th>
                                <th>ID de la ONT</th>
                                <th>Status</th>
                                <th>Cédula del Cliente</th>
                                <th>ID Cuenta del Cliente</th>
                                <th>Plan Contratado</th>
                                <th>Dirección de Contrato</th>
                                <th>Motivo de Pausa</th>
                                <th>Fecha de Instalación</th>
                                <th>Recursos Usados</th>
                                <th>Observaciones</th>
                                <th>Contratista Asignado</th>
                                <th>Teléfono del Cliente</th>
                                <th>Nodo</th>
                            </tr>
                        </thead>
                        <% if (contratos[0] != undefined) {%>
                        <tbody>
                        <% for (let index = 0; index < contratos[0].length; index++) { %>
                            <tr >
                                <td><%=contratos[0][index].fecha_contrato %></td>
                                <td><%=contratos[0][index].id %></td>
                                <% if (contratos[0][index].estatus_ == 0){%>
                                    <td>Agendado</td>
                                    <% }else if (contratos[0][index].estatus_ == 1){ %>
                                        <td>Instalado</td>
                                    <% }else if(contratos[0][index].estatus_ == 2){ %>
                                        <td>Finalizado</td>
                                    <% } %>
                                <td><%=contratos[0][index].ci_cliente %></td>
                                <td><%=contratos[0][index].id_cuenta %></td>
                                <td><%=contratos[0][index].plan_contratado %></td>
                                <td><%=contratos[0][index].direccion_contrato %></td>
                                <td><%=contratos[0][index].motivo_standby %></td>
                                <td><%=contratos[0][index].fecha_instalacion %></td>
                                <td><%=contratos[0][index].recursos_inventario_instalacion %></td>
                                <td><%=contratos[0][index].observaciones_instalacion %></td>
                                <td><%=contratos[0][index].contratista_asignado %></td>
                                <td><%=contratos[0][index].telefono_cliente %></td>
                                <td><%=contratos[0][index].nodo %></td>
                            </tr> 
                        </tbody>
                    </table>
                  </div>
                  <div class="contrat-status text center">
                    <% if (contratos[0][index].estatus_ != 2) {%>
                    <form class="boton-update" action="/update-contrato/<%=contratos[0][0].id%>" method="GET">
                        <a class="botons-green" href="/update-contrato/<%=contratos[0][0].id%>"> EDITAR</a>
                        <a class="botons-red" href="/delete-contrato/<%=contratos[0][0].id%>" onclick="miAlerta()"> ELIMINAR</a>
                        <script>
                            function miAlerta(evento) {
                                const confirmDelete = window.confirm("¿Estás seguro que deseas eliminar este registro?")
                                if (!(confirmDelete)){
                                    event.preventDefault();
                                }}
                        </script>
                    </form>
                    <% } %>
                </div>
                        <% } %>
                        
                <% }else{ %>
                <tbody>
                    <tr>
                        <td></td>
                        <td></td>
                        <td></td>
                    </tr> 
                </tbody>
            </table>
          </div>
        
                <% } %>
               
        
            </section>
        
            <% }else{ %>

                   
                <div class="welcomers text-center">
                    <h5 id="welcomers">ESTE CONTRATO NO ESTÁ ASIGNADO A USTED</h5>
                </div>
            

                <% } %>

 <!--Menu superior CONTRATISTAS--><% }else{ %>
        <!-- vista del contratista -->

</head>
 <body>
     
    <section class="bienvenidos">
            <%- include("partials/_header_logged_contratistas") %>

            <div class="welcomers text-center">
                <% if (sexo) { %>
           
                   <h5 id="welcomers" class=" wow bounceIn">Bienvenida </h5> <h5 class="nombre_contrat wow bounceIn"> <%=name %> </h5>

               <% }else{ %>

                   <h5 id="welcomers" class=" wow bounceIn">Bienvenido </h5> <h5 class="nombre_contrat wow bounceIn"> <%=name %> </h5>

              <% } %>
              </div>
              <div class="contratos_firstview">
                <h6 id="welcomers"> CONTRATO  <%=contratos[0][0].id %></h6>
                <table id="lista-contratos" class="secondary-table table-striped">
                    <thead> 
                        <tr>
                            <th>Fecha contrato</th>
                            <th>ID de la ONT</th>
                            <th>Status</th>
                            <th>Cédula del Cliente</th>
                            <th>ID Cuenta del Cliente</th>
                            <th>Plan Contratado</th>
                            <th>Dirección de Contrato</th>
                            <th>Motivo de Pausa</th>
                            <th>Fecha de Instalación</th>
                            <th>Recursos Usados</th>
                            <th>Observaciones</th>
                            <th>Contratista Asignado</th>
                            <th>Teléfono del Cliente</th>
                            <th>Nodo</th>
                        </tr>
                    </thead>
                    <% if (contratos[0] != undefined) {%>
                    <tbody>
                    <% for (let index = 0; index < contratos[0].length; index++) { %>
                        <tr >
                            <td><%=contratos[0][index].fecha_contrato %></td>
                            <td><%=contratos[0][index].id %></td>
                            <% if (contratos[0][index].estatus_ == 0){%>
                                <td>Agendado</td>
                                <% }else if (contratos[0][index].estatus_ == 1){ %>
                                    <td>Instalado</td>
                                <% }else if(contratos[0][index].estatus_ == 2){ %>
                                    <td>Finalizado</td>
                                <% } %>
                            <td><%=contratos[0][index].ci_cliente %></td>
                            <td><%=contratos[0][index].id_cuenta %></td>
                            <td><%=contratos[0][index].plan_contratado %></td>
                            <td><%=contratos[0][index].direccion_contrato %></td>
                            <td><%=contratos[0][index].motivo_standby %></td>
                            <td><%=contratos[0][index].fecha_instalacion %></td>
                            <td><%=contratos[0][index].recursos_inventario_instalacion %></td>
                            <td><%=contratos[0][index].observaciones_instalacion %></td>
                            <td><%=contratos[0][index].contratista_asignado %></td>
                            <td><%=contratos[0][index].telefono_cliente %></td>
                            <td><%=contratos[0][index].nodo %></td>
                        </tr> 
                    
                    </tbody>
                </table>
              </div>
              <% if(id_contrat == contratos[0][0].contratista_asignado) {%>
                <div class="contrat-status text center">
                    <% if (contratos[0][index].estatus_ != 2) {%>
                    <form class="boton-update" action="/update-contrato/<%=contratos[0][0].id%>" method="GET">
                        <a class="botons-green" href="/update-contrato/<%=contratos[0][0].id%>"> EDITAR</a>
                    </form>
                    <% } %>
                </div>
                
                <% }else{ %>
                    
                <div class="welcomers text-center">
                    <h5 id="welcomers">ESTE CONTRATO NO ESTÁ ASIGNADO A USTED</h5>
                </div>
            
                    <% } %>
                    <% } %>
            <% }else{ %>
            <tbody>
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr> 
                    </tbody>
            </table>
        </div>
            <% } %>
            
            
                    <% } %>

        </section>
<!--Menu superior--><% }else { %>
            </head>
            <body>
              
                <section class="bienvenidos">
                    <%- include("partials/_header") %>
                    <% } %>
            
                    
    </section>


      
    <%- include("partials/_footer") %>

    <!--Carga de archivos js-->
    <script src="/styles/scriptindex.js"></script> 
    <script src="contratistas-styles/js/jquery-1.9.1.min.js"></script>
    <script src="contratistas-styles/js/bootstrap.min.js"></script>
    <script src="contratistas-styles/js/owl.carousel.min.js"></script>
    <script type="text/javascript">
        $(document).ready(function() {
            $(".owl-carousel").owlCarousel({
                loop: true,
                margin: 0,
                nav: true,
                autoWidth: false,
                navText: ['<i class="fa fa-arrow-circle-left" title="Anterior"></i>', '<i class="fa  fa-arrow-circle-right" title="Siguiente"></i>'],
                responsive: {
                    0: {
                        items: 1
                    },
                    500: {
                        items: 2,
                        margin: 20
                    },
                    800: {
                        items: 3,
                        margin: 20
                    },
                    1000: {
                        items: 4,
                        margin: 20
                    }
                }
            });
        });
    </script>
    <script src="/contratistas-styles/js/wow.min.js"></script>
    <script src="/contratistas-styles/js/smooth-scroll.min.js"></script>
    <script src="/contratistas-styles/js/sitio.js"></script>
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
    <script src="/styles/sweetalert210.js"></script>
    <% if (typeof alert != "undefined")  { %>
      <script>
      Swal.fire({
      title:'<%= alertTitle %>',
      text:'<%= alertMessage %>',
      icon:'<%= alertIcon %>',
      showConfirmButton: '<%= showConfirmButton %>',
      timer: '<%= timer %>'
    }).then(()=>{
      window.location='/<%= ruta %>'
    })
        </script>
        <% } %>
    <script type="text/javascript">
        const socket = io()
    </script>
</body>

</html>