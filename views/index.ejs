<%- include("partials/_head") %>
    <% if (login) {%>
<!--Menu superior ADMINISTRADORES--> <% if (rol == 2) {%>

</head>
<body>
    
    <section class="bienvenidos">
        <%- include("partials/_header_logged_admin") %>

        <div class="welcomers text-center">
            <% if (sexo) { %>
           
                <h5 id="welcomers" class=" wow bounceIn">Bienvenida </h5> <h5 class="nombre_contrat wow bounceIn"> <%=name %> </h5>

            <% }else{ %>

                <h5 id="welcomers" class=" wow bounceIn">Bienvenido </h5> <h5 class="nombre_contrat wow bounceIn"> <%=name %> </h5>

           <% } %>
        </div>
        <div class="estadisticas">

            <table id="estadisticas" class="principal-table table-striped">
                <thead>
                    <th>Contratos Registrados</th>
                    <th>Contratos Instalados</th>
                    <th>Contratos Finalizados</th>
                    <th>Contratos Pendientes</th>
                </thead>
                <tbody>
                    <td><%=contratos[0].length %></td>
                    <% let instalados = contratos[0].filter(status => status.estatus_ == 1) %>
                    <td><%= instalados.length%></td>
                    <% let finalizados = contratos[0].filter(status => status.estatus_ == 2) %>
                    <td><%= finalizados.length %></td>
                    <% let agendados = contratos[0].filter(status => status.estatus_ == 0) %>
                    <td><%= agendados.length %></td>
                </tbody>
            </table>

            <table id="estadisticas_2" class="principal-table table-striped">
                <thead>
                    <th>Contratos Instalados Servitel</th>
                    <th>Contratos Pendientes Servitel</th>
                    <th>Contratos Instalados Hetelca</th>
                    <th>Contratos Pendientes Hetelca</th>
                </thead>
                <tbody>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tbody>
            </table>
        </div>
        <div class="contratos_firstview">
            <h6 id="welcomers"> CONTRATOS </h6>
            <form action="">
                <select name="cantidad" id="can">
                <option value="">*</option>
                <option value="10">10</option>
                <option value="20">20</option>
                <option value="30">30</option>
                <option value="50">50</option>
                <option value="100">100</option>
            </select>
            <select name="página" id="pag">
                <option value="1">página 1</option>
                <option value="2">página 2</option>
                <option value="3">página 3</option>
                <option value="4">página 4</option>
                <option value="5">página 5</option>
            </select>
            </form>
            <form action="" method="POST">
                <input type="Date" name="desde_fecha" id="">
                <input type="Date" name="hasta_fecha" id="">
                <input type="text" name="id_contrato" placeholder="Id contrato" id="id_contrato">
                <select type="" name="estatus_" id=""> 
                    <option value="">Seleccione Status</option>
                    <option value="0">Agendado</option>
                    <option value="1">Instalado</option>
                    <option value="2">Finalizado</option>
                    </select>
                <select type="text" name="empresa_contratista" id="">
                    <option value="">Seleccione Contratista</option>
                    <option value="0">Hetelca</option>
                    <option value="1">Servitel</option>
                </select>
                <input type="text" name="instalador" placeholder="Instalador" id="">
                <input type="text" name="nodo" placeholder="nodo" id="">
                <input type="submit" name="" id="">
            </form>

            <table id="lista-contratos" class="principal-table table-striped">
                <thead> 
                    <tr>
                        <th>#</th>
                        <th>Fecha contrato</th>
                        <th>ID del contrato</th>
                        <th>Status</th>
                        <th>Empresa Contratista</th>
                    </tr>
                </thead>
                <% if (contratos[0] != undefined) {%>
                <tbody id="contratos">
                <% for (let index = 0; index < contratos[0].length; index++) { %>
                    <tr id="tr<%=index %>"  >
                        <td><%=index+1 %> </td>
                        <td  id="fecha"><a href="/contratos/<%=contratos[0][index].id %>"><%=contratos[0][index].fecha_contrato %></a></td>
                        <td id="id"><a href="/contratos/<%=contratos[0][index].id %>"><%=contratos[0][index].id %></a></td>
                        <% if (contratos[0][index].estatus_ == 0){%>
                            <td>Agendado</td>
                            <% }else if (contratos[0][index].estatus_ == 1){ %>
                                <td>Instalado</td>
                            <% }else if(contratos[0][index].estatus_ == 2){ %>
                                <td>Finalizado</td>
                            <% } %>
                        <% if (contratos[0][index].empresa_contratista == 0){%>
                            <td>Hetelca</td>
                            <% }else{ %>
                            <td>Servitel</td>
                            <% } %>
                    </tr> 
                <% } %>
                </tbody>
            </table>
          </div>
        <% }else{ %>
        <tbody>
            <tr>
                <td></td>
                <td></td>
                <td></td>
            </tr> 
        <% } %>
        </tbody>
    </table>
  </div>


    </section>



    <% }else if (rol == 1 ){%>
        <!--Menu superior ADMINISTRADORES CONTRATISTAS--> 
        
    </head>
    <body>
        
        <section class="bienvenidos">
            <%- include("partials/_header_logged_admin") %>
    
            <div class="welcomers text-center">
                <% if (sexo) { %>
               
                    <h5 id="welcomers" class=" wow bounceIn">Bienvenida </h5> <h5 class="nombre_contrat wow bounceIn"> <%=name %> </h5>
    
                <% }else{ %>
    
                    <h5 id="welcomers" class=" wow bounceIn">Bienvenido </h5> <h5 class="nombre_contrat wow bounceIn"> <%=name %> </h5>
    
               <% } %>
            </div>
            <div class="estadisticas">

                <table id="estadisticas" class="principal-table table-striped">
                    <thead>
                        <th>Contratos Registrados</th>
                        <th>Contratos Instalados</th>
                        <th>Contratos Finalizados</th>
                        <th>Contratos Pendientes</th>
                    </thead>
                    <tbody>
                        <td><%=contratos[0].length %></td>
                        <% let instalados = contratos[0].filter(status => status.estatus_ == 1) %>
                        <td><%= instalados.length%></td>
                        <% let finalizados = contratos[0].filter(status => status.estatus_ == 2) %>
                        <td><%= finalizados.length %></td>
                        <% let agendados = contratos[0].filter(status => status.estatus_ == 0) %>
                        <td><%= agendados.length %></td>
                    </tbody>
                </table>
    
                <table id="estadisticas_2" class="principal-table table-striped">
                    <thead>
                        <th>Contratos Instalados Servitel</th>
                        <th>Contratos Pendientes Servitel</th>
                        <th>Contratos Instalados Hetelca</th>
                        <th>Contratos Pendientes Hetelca</th>
                    </thead>
                    <tbody>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                    </tbody>
                </table>
            </div>
            <div class="contratos_firstview">
                <h6 id="welcomers"> CONTRATOS </h6>
                <form action="">
                    <select name="cantidad" id="can">
                    <option value="">*</option>
                    <option value="10">10</option>
                    <option value="20">20</option>
                    <option value="30">30</option>
                    <option value="50">50</option>
                    <option value="100">100</option>
                </select>
                <select name="página" id="pag">
                    <option value="1">página 1</option>
                    <option value="2">página 2</option>
                    <option value="3">página 3</option>
                    <option value="4">página 4</option>
                    <option value="5">página 5</option>
                </select>
                </form>
                <form action="" method="POST">
                    <input type="Date" name="desde_fecha" id="">
                    <input type="Date" name="hasta_fecha" id="">
                    <input type="text" name="id_contrato" placeholder="Id contrato" id="id_contrato">
                    <select type="" name="estatus_" id=""> 
                        <option value="">Seleccione Status</option>
                        <option value="0">Agendado</option>
                        <option value="1">Instalado</option>
                        <option value="2">Finalizado</option>
                        </select>
                    <input type="text" name="instalador" placeholder="Instalador" id="">
                    <input type="text" name="nodo" placeholder="nodo" id="">
                    <input type="submit" name="" id="">
                </form>
                <table id="lista-contratos" class="principal-table table-striped">
                    <thead> 
                        <tr>
                            <th>#</th>
                            <th>Fecha contrato</th>
                            <th>ID del contrato</th>
                            <th>Status</th>
                            <th>empresa contratista</th>
                        </tr>
                    </thead>
                    <% if (contratos[0] != undefined) {%>
                    <tbody id="contratos">
                    <% for (let index = 0; index < contratos[0].length; index++) { %>
                        <tr id="tr<%=index %>">
                            <td><%=index+1 %> </td>
                            <td><a href="/contratos/<%=contratos[0][index].id %>"><%=contratos[0][index].fecha_contrato %></a></td>
                            <td><a href="/contratos/<%=contratos[0][index].id %>"><%=contratos[0][index].id %></a></td>
                            <% if (contratos[0][index].estatus_ == 0){%>
                                <td>Agendado</td>
                                <% }else if (contratos[0][index].estatus_ == 1){ %>
                                    <td>Instalado</td>
                                <% }else if(contratos[0][index].estatus_ == 2){ %>
                                    <td>Finalizado</td>
                                <% } %>
                            <% if (contratos[0][index].empresa_contratista == 0){%>
                                <td>Hetelca</td>
                                <% }else{ %>
                                <td>Servitel</td>
                                <% } %>
                        </tr> 
                    <% } %>
                    </tbody>
                </table>
              </div>
            <% }else{ %>
            <tbody>
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr> 
            <% } %>
            </tbody>
        </table>
      </div>
    
    
        </section>


 <!--Menu superior CONTRATISTAS--><% }else{ %>
        <!-- vista del contratista -->


</head>
 <body>
     
    <section class="bienvenidos">
            <%- include("partials/_header_logged_contratistas") %>

            <div class="welcomers text-center">
                <% if (sexo) { %>
           
                   <h5 id="welcomers" class=" wow bounceIn">Bienvenida </h5> <h5 class="nombre_contrat wow bounceIn"> <%=name %> </h5>

               <% }else{ %>

                   <h5 id="welcomers" class=" wow bounceIn">Bienvenido </h5> <h5 class="nombre_contrat wow bounceIn"> <%=name %> </h5>

              <% } %>
              </div>
              <div class="contratos_firstview">
                <h6 id="welcomers"> CONTRATOS <% if (estatus == 1) {%> PENDIENTES <% }else if(estatus == 2){%> EMITIDOS <% }else{ %>  <% } %></h6>
                <form action="" method="POST">
                    <input type="Date" name="desde_fecha" id="">
                    <input type="Date" name="hasta_fecha" id="">
                    <input type="text" name="id_contrato" placeholder="Id contrato" id="id_contrato">
                    <select type="" name="estatus_" id=""> 
                        <option value="">Seleccione Status</option>
                        <option value="0">Agendado</option>
                        <option value="1">Instalado</option>
                        <option value="2">Finalizado</option>
                        </select>
                    <input type="text" name="nodo" placeholder="nodo" id="">
                    <input type="submit" name="" id="">
                </form>
                <table id="lista-contratos" class="principal-table table-striped">
                    <thead> 
                        <tr>
                            <th>Fecha contrato</th>
                            <th>ID del contrato</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <% if (contratos[0] != undefined) {%>
                    <tbody>
                    <% for (let index = 0; index < contratos[0].length; index++) { %>
                        <tr >
                            <td><a href="/contratos/<%=contratos[0][index].id %>"><%=contratos[0][index].fecha_contrato %></a></td>
                            <td><a href="/contratos/<%=contratos[0][index].id %>"><%=contratos[0][index].id %></a></td>
                            <% if (contratos[0][index].estatus_ == 0){%>
                                <td>Agendado</td>
                                <% }else if (contratos[0][index].estatus_ == 1){ %>
                                    <td>Instalado</td>
                                <% }else if(contratos[0][index].estatus_ == 2){ %>
                                    <td>Finalizado</td>
                                <% } %>
                        </tr> 
                    <% } %>
                    </tbody>
                </table>
              </div>
            <% }else{ %>
            <tbody>
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr> 
            <% } %>
            </tbody>
        </table>
      </div>


                <% } %>

        </section>
<!--Menu superior--><% }else { %>

    <!-- vista del administrador -->
            </head>
            <body>
              
                <section class="bienvenidos">
                    <%- include("partials/_header") %>
                </section>
                    <% } %>
            
                    <button class="boton-subir">subir</button>
    


      
    <%- include("partials/_footer") %>

    <!--Carga de archivos js-->
    <script src="/styles/scriptindex.js"></script> 
    <script src="contratistas-styles/js/jquery-1.9.1.min.js"></script>
    <script src="contratistas-styles/js/bootstrap.min.js"></script>
    <script src="contratistas-styles/js/owl.carousel.min.js"></script>
    <script type="text/javascript">


       
    </script>
    <script src="contratistas-styles/js/wow.min.js"></script>
    <script src="contratistas-styles/js/smooth-scroll.min.js"></script>
    <script src="contratistas-styles/js/sitio.js"></script>
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
    <script type="text/javascript">
    

        var ContratArray = []
        var dateArray = []
        let contratos_ = document.getElementById('contratos')
        let columnas = contratos.children


        
        for (let index = 0; index < columnas.length; index++) {
            ContratArray.push(columnas[index])
        }
        console.log(ContratArray)
        console.log(dateArray)
        
        const pagina = document.getElementById('pag')
        const cantidad = document.getElementById('can')
        function recargar() {
            window.location.reload()
        }
        const lengthTabla = columnas.length -1
     const separador_cantidad = async ()=>{
        let indexTabla = columnas.length-1
        let indexInsert = columnas.length-1
        
        
        console.log('este es el índice inicial de la tabla', indexTabla)
        console.log('esta es la longitud fija de la tabla', lengthTabla)
        let parentDiv = document.getElementById('contratos');
        console.log(parentDiv)
        console.log ('esta es la cantidad de contratos que se deben visualizar ', cantidad.options[cantidad.selectedIndex].value) 
        let columnas_contratos = []
        //vista de 10 elementos
             if(cantidad.options[cantidad.selectedIndex].value == 10 && indexTabla == lengthTabla){
                
                    console.log(columnas.length)
                    for (let index = 10; index < columnas.length; index){
                    console.log('este es el indice de 10 ',index)
                    let inicio = await columnas[index].parentNode.removeChild(columnas[index])
                    columnas_contratos.push(inicio)
                    console.log ('se ha eliminado la columna ', inicio, columnas_contratos)
                    console.log(columnas_contratos.lenght)
                    }

                    console.log('este es el índice final de la tabla', indexTabla)
                }else if(cantidad.options[cantidad.selectedIndex].value == 10 && indexTabla != lengthTabla){
                    for (let i = indexInsert; i < lengthTabla; i++) {
                        console.log('indice ',i,'indice general ', indexInsert)
                     await parentDiv.insertBefore(columnas[indexInsert], ContratArray[i].nextSibling)
                    console.log('se ha insertado la columna ', columnas[indexInsert] ,'arreglo ', ContratArray[i])
                    }
                console.log(columnas.length)
                for (let index = 10; index < columnas.length; index){
                console.log('este es el indice de 10 ',index)
                let inicio = await columnas[index].parentNode.removeChild(columnas[index])
                console.log ('se ha eliminado la columna ', inicio, columnas_contratos)
                console.log(columnas_contratos.lenght)
                }

                console.log('este es el índice final de la tabla', indexTabla)


        //vista de 20 elementos
                }else if(cantidad.options[cantidad.selectedIndex].value == 20 && indexTabla == lengthTabla){

                    for (let index = 20; index < columnas.length; index){
                    console.log('este es el indice de 20 ',index)
                    let inicio = await columnas[index].parentNode.removeChild(columnas[index])
                    columnas_contratos.push(inicio)
                    console.log ('se ha eliminado la columna ', inicio)
                    }

                    console.log('este es el índice final de la tabla', indexTabla)

                }else if(cantidad.options[cantidad.selectedIndex].value == 20  && indexTabla != lengthTabla){
                    for (let i = indexInsert; i < lengthTabla; i++) {
                        console.log('indice ',i,'indice general ', indexInsert)
                     await parentDiv.insertBefore(columnas[indexInsert], ContratArray[i].nextSibling)
                    console.log('se ha insertado la columna ', columnas[indexInsert] ,'arreglo ', ContratArray[i])
                    }

                console.log(columnas.length, ContratArray)
                    for (let index = 20; index < columnas.length; index){
                    console.log('este es el indice de 20 ',index)
                    let inicio = await columnas[index].parentNode.removeChild(columnas[index])
                    columnas_contratos.push(inicio)
                    console.log ('se ha eliminado la columna ', inicio)
                    }

                    console.log('este es el índice final de la tabla', indexTabla)


        //vista de 30 elementos
                }else if(cantidad.options[cantidad.selectedIndex].value == 30){
                console.log(columnas.length)
                    for (let index = 30; index < columnas.length; index){
                    console.log(index)
                    let inicio = columnas[index].parentNode.removeChild(columnas[index])
                    columnas_contratos.push(inicio)
                    console.log ('se ha eliminado la columna ', inicio)
                    }
                    
                }else if(cantidad.options[cantidad.selectedIndex].value == 30  && indexTabla != lengthTabla){
                    for (let i = indexInsert; i < lengthTabla; i++) {
                        console.log('indice ',i,'indice general ', indexInsert)
                     await parentDiv.insertBefore(columnas[indexInsert], ContratArray[i].nextSibling)
                    console.log('se ha insertado la columna ', columnas[indexInsert] ,'arreglo ', ContratArray[i])
                    }

                console.log(columnas.length, ContratArray)
                    for (let index = 20; index < columnas.length; index){
                    console.log('este es el indice de 20 ',index)
                    let inicio = await columnas[index].parentNode.removeChild(columnas[index])
                    columnas_contratos.push(inicio)
                    console.log ('se ha eliminado la columna ', inicio)
                    }

                    console.log('este es el índice final de la tabla', indexTabla)


        //vista de 50 elementos
                }else if(cantidad.options[cantidad.selectedIndex].value == 50){
                console.log(columnas.length)
                    for (let index = 50; index < columnas.length; index){
                    console.log(index)
                    let inicio = columnas[index].parentNode.removeChild(columnas[index])
                    columnas_contratos.push(inicio)
                    console.log ('se ha eliminado la columna ', inicio)
                    }
                }else if(cantidad.options[cantidad.selectedIndex].value == 50  && indexTabla != lengthTabla){
                    for (let i = indexInsert; i < lengthTabla; i++) {
                        console.log('indice ',i,'indice general ', indexInsert)
                     await parentDiv.insertBefore(columnas[indexInsert], ContratArray[i].nextSibling)
                    console.log('se ha insertado la columna ', columnas[indexInsert] ,'arreglo ', ContratArray[i])
                    }

                console.log(columnas.length, ContratArray)
                    for (let index = 20; index < columnas.length; index){
                    console.log('este es el indice de 20 ',index)
                    let inicio = await columnas[index].parentNode.removeChild(columnas[index])
                    columnas_contratos.push(inicio)
                    console.log ('se ha eliminado la columna ', inicio)
                    }

                    console.log('este es el índice final de la tabla', indexTabla)

        //vista de 100 elementos
                }else if(cantidad.options[cantidad.selectedIndex].value == 100){
                console.log(columnas.length)
                    for (let index = 100; index < columnas.length; index){
                    console.log(index)
                    let inicio = columnas[index].parentNode.removeChild(columnas[index])
                    columnas_contratos.push(inicio)
                    console.log ('se ha eliminado la columna ', inicio)
                    }
                }else if(cantidad.options[cantidad.selectedIndex].value == 100  && indexTabla != lengthTabla){
                    for (let i = indexInsert; i < lengthTabla; i++) {
                        console.log('indice ',i,'indice general ', indexInsert)
                     await parentDiv.insertBefore(columnas[indexInsert], ContratArray[i].nextSibling)
                    console.log('se ha insertado la columna ', columnas[indexInsert] ,'arreglo ', ContratArray[i])
                    }

                console.log(columnas.length, ContratArray)
                    for (let index = 20; index < columnas.length; index){
                    console.log('este es el indice de 20 ',index)
                    let inicio = await columnas[index].parentNode.removeChild(columnas[index])
                    columnas_contratos.push(inicio)
                    console.log ('se ha eliminado la columna ', inicio)
                    }

                    console.log('este es el índice final de la tabla', indexTabla)

                }else if (cantidad.options[cantidad.selectedIndex].value == ''){
                    window.location.reload()
                }
                console.log(columnas[10])
        }

        
       function separador_pagina(event){

        
        console.log(pagina.options[pagina.selectedIndex].value);

        console.log(cantidad.options[cantidad.selectedIndex].value);
        // if(cantidad.options[cantidad.selectedIndex].value == 10 && pagina.options[pagina.selectedIndex].value == 1){
        //             console.log(columnas.length)
        //         }else if(cantidad.options[cantidad.selectedIndex].value == 20){
        //         console.log(columnas.length)
        //             for (let index = 20; index < columnas.length; index){
        //             console.log(index)
        //             let inicio = columnas[index].parentNode.removeChild(columnas[index])
        //             console.log ('se ha eliminado la columna ', inicio)
        //             }
        //         }else if(cantidad.options[cantidad.selectedIndex].value == 30){
        //         console.log(columnas.length)
        //             for (let index = 30; index < columnas.length; index){
        //             console.log(index)
        //             let inicio = columnas[index].parentNode.removeChild(columnas[index])
        //             console.log ('se ha eliminado la columna ', inicio)
        //             }
        //         }else if(cantidad.options[cantidad.selectedIndex].value == 50){
        //         console.log(columnas.length)
        //             for (let index = 50; index < columnas.length; index){
        //             console.log(index)
        //             let inicio = columnas[index].parentNode.removeChild(columnas[index])
        //             console.log ('se ha eliminado la columna ', inicio)
        //             }
        //         }else if(cantidad.options[cantidad.selectedIndex].value == 100){
        //         console.log(columnas.length)
        //             for (let index = 100; index < columnas.length; index){
        //             console.log(index)
        //             let inicio = columnas[index].parentNode.removeChild(columnas[index])
        //             console.log ('se ha eliminado la columna ', inicio)
        //             }
        //      }
        
        }

        if(!(pagina.options[pagina.selectedIndex].value && cantidad.options[cantidad.selectedIndex].value)){
            cantidad.addEventListener("change", separador_cantidad);
        }
        pagina.addEventListener("change", separador_pagina)
        
    </script>
</body>

</html>